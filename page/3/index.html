<!DOCTYPE HTML>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>第 3 页 | Ewkoll</title>

  
  <meta name="author" content="ideath@operatorworld.com">
  

  
  <meta name="description" content="knowledge">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="Ewkoll"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Ewkoll" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 4.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


<body>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Ewkoll</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/about">关于</a></li>
      
        <li><a href="/atom.xml">订阅</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2020/06/02/Caliper区块链性能测试工具/"><span>Caliper区块链性能测试工具</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/06/02/Caliper区块链性能测试工具/" rel="bookmark">
        <time class="entry-date published" datetime="2020-06-02T01:43:32.000Z">
          2020-06-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="初始化工程"><a class="markdownIt-Anchor" href="#初始化工程"></a> 初始化工程</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 初始化工程</span><br><span class="line">npm init 或者 npm init -y</span><br><span class="line"></span><br><span class="line"># 安装</span><br><span class="line">npm install --only&#x3D;prod @hyperledger&#x2F;caliper-cli@0.3.0</span><br><span class="line"></span><br><span class="line"># 绑定SDK版本</span><br><span class="line">npx caliper bind --caliper-bind-sut fabric:1.4.5</span><br></pre></td></tr></table></figure>
<h2 id="命令提示"><a class="markdownIt-Anchor" href="#命令提示"></a> 命令提示</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npx caliper --version</span><br><span class="line">npx caliper --help</span><br><span class="line">npx caliper bind --help</span><br><span class="line">npx caliper benchmark run --help</span><br></pre></td></tr></table></figure>
<h2 id="fabric的版本"><a class="markdownIt-Anchor" href="#fabric的版本"></a> Fabric的版本</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http:&#x2F;&#x2F;bit.ly&#x2F;2ysbOFE | bash -s -- 1.4.7 1.4.7 0.4.20 -ds</span><br><span class="line">curl -sSL http:&#x2F;&#x2F;bit.ly&#x2F;2ysbOFE | bash -s -- 1.4.6 1.4.6 0.4.18 -ds</span><br></pre></td></tr></table></figure>
<h2 id=""><a class="markdownIt-Anchor" href="#"></a> </h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npx caliper launch master \</span><br><span class="line">    --caliper-workspace . \</span><br><span class="line">    --caliper-benchconfig benchmarks&#x2F;scenario&#x2F;simple&#x2F;config.yaml \</span><br><span class="line">    --caliper-networkconfig networks&#x2F;fabric&#x2F;fabric-v1.4.4&#x2F;2org1peercouchdb_raft&#x2F;fabric-go-tls-solo.yaml</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/06/01/Gulp/"><span>Gulp</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/06/01/Gulp/" rel="bookmark">
        <time class="entry-date published" datetime="2020-06-01T03:12:14.000Z">
          2020-06-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><a href="https://www.gulpjs.com.cn/" target="_blank" rel="noopener">Gulp</a></p>
<p><a href="https://www.gulpjs.com.cn/docs/getting-started/quick-start/" target="_blank" rel="noopener">安装</a></p>
<h2 id="调试"><a class="markdownIt-Anchor" href="#调试"></a> 调试</h2>
<h2 id="scss"><a class="markdownIt-Anchor" href="#scss"></a> Scss</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-sass gulp-sass --save-dev</span><br></pre></td></tr></table></figure>
<h2 id="缩小css"><a class="markdownIt-Anchor" href="#缩小css"></a> 缩小css</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-clean-css --save-dev</span><br></pre></td></tr></table></figure>
<h2 id="源码映射"><a class="markdownIt-Anchor" href="#源码映射"></a> 源码映射</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-sourcemaps --save-dev</span><br><span class="line">npm install fibers</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/06/01/Mermaid/"><span>Mermaid</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/06/01/Mermaid/" rel="bookmark">
        <time class="entry-date published" datetime="2020-06-01T02:06:17.000Z">
          2020-06-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><a href="https://mermaid-js.github.io/mermaid/#/flowchart" target="_blank" rel="noopener">Mermaid</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/05/27/Java相关/"><span>Java相关</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/05/27/Java相关/" rel="bookmark">
        <time class="entry-date published" datetime="2020-05-27T02:30:20.000Z">
          2020-05-27
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="环境搭建"><a class="markdownIt-Anchor" href="#环境搭建"></a> 环境搭建</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">brew search maven</span><br><span class="line">brew info maven</span><br><span class="line">brew install maven</span><br><span class="line">brew remove maven</span><br><span class="line">brew cleanup</span><br><span class="line">brew list          列出已安装的软件</span><br><span class="line">brew update        更新brew</span><br><span class="line">brew home          用浏览器打开brew的官方网站</span><br><span class="line">brew info          显示软件信息</span><br><span class="line">brew deps          显示包依赖</span><br></pre></td></tr></table></figure>
<ul>
<li>修改Maven国内源</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">brew 安装目录下查找maven的conf目录中settings.xml文件修改。</span><br><span class="line"></span><br><span class="line">&lt;mirrors&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;alimaven&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;name&gt;aliyun maven&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">    &lt;&#x2F;mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;alimaven&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">        &lt;name&gt;aliyun maven&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;central&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;mirror&gt;</span><br><span class="line">&lt;&#x2F;mirrors&gt;</span><br></pre></td></tr></table></figure>
<h2 id="注解"><a class="markdownIt-Anchor" href="#注解"></a> 注解</h2>
<h3 id="value"><a class="markdownIt-Anchor" href="#value"></a> @Value</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从配置文件中读取。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;PeerLocation&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> String PeerLocation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"张三"</span>)</span><br><span class="line"><span class="keyword">private</span> String UserName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 年龄</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"26"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer Age;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从组件注入变量，这个必须是个公开的变量。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"#&#123;beanValue.AnotherValue&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String BeanValue;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanValue</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"AnotherValue"</span>)</span><br><span class="line">    <span class="keyword">public</span> String AnotherValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="动态调用指令"><a class="markdownIt-Anchor" href="#动态调用指令"></a> 动态调用指令</h2>
<p>对应于class文件中CONSTANT_InvokeDynamic的指令。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicInvoke</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Runnable r = () -&gt; System.out.println(Arrays.toString(args));</span><br><span class="line">        r.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">javac DynamicInvoke.java 生成<span class="class"><span class="keyword">class</span>文件。</span></span><br><span class="line"><span class="class"><span class="title">javap</span> -<span class="title">v</span> -<span class="title">p</span> <span class="title">DynamicInvoke</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line">public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: (<span class="number">0x0009</span>) ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">        stack=<span class="number">1</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">            <span class="number">0</span>: aload_0</span><br><span class="line">            1: invokedynamic #2,  0              // InvokeDynamic #0:run:([Ljava/lang/String;)Ljava/lang/Runnable;</span><br><span class="line">            <span class="number">6</span>: astore_1</span><br><span class="line">            <span class="number">7</span>: aload_1</span><br><span class="line">            8: invokeinterface #3,  1            // InterfaceMethod java/lang/Runnable.run:()V</span><br><span class="line">        <span class="number">13</span>: <span class="keyword">return</span></span><br><span class="line">        LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">8</span>: <span class="number">7</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">13</span></span><br></pre></td></tr></table></figure>
<p>可以看到mian函数中存在对应的动态调用函数。</p>
<h2 id="jpa-双向关联"><a class="markdownIt-Anchor" href="#jpa-双向关联"></a> Jpa 双向关联</h2>
<p>1、双向关联后会到导致Json序列化堆栈溢出.<br />
解决方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonIgnore</span> 同时也能解决Jpa Lay Init 序列化异常问题.</span><br></pre></td></tr></table></figure>
<p>2、解决查看对象的时候,因相互引用导致堆栈溢出问题.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通过lombok排除某些对象的Hash计算和Tostring方法.</span><br><span class="line"><span class="meta">@ToString</span>(exclude = &#123;<span class="string">"userLevelInfo"</span>, <span class="string">"roleInfo"</span>, <span class="string">"userACLList"</span>, <span class="string">"userPaymentList"</span>&#125;)</span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(callSuper = <span class="keyword">true</span>, exclude = &#123;<span class="string">"userLevelInfo"</span>, <span class="string">"roleInfo"</span>, <span class="string">"userACLList"</span>, <span class="string">"userPaymentList"</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>3、在关联中设定fetchType和fetchMode解决数据加载时机和方式.</p>
<p><a href="https://www.baeldung.com/hibernate-lazy-loading-workaround" target="_blank" rel="noopener">参考链接</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Java/">Java</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Java/">Java</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/05/26/SQL注入/"><span>SQL注入</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/05/26/SQL注入/" rel="bookmark">
        <time class="entry-date published" datetime="2020-05-26T07:42:25.000Z">
          2020-05-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/05/26/XSS原理/"><span>XSS原理</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/05/26/XSS原理/" rel="bookmark">
        <time class="entry-date published" datetime="2020-05-26T07:42:16.000Z">
          2020-05-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/05/26/浏览器同源策略以及跨域/"><span>浏览器同源策略以及跨域</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/05/26/浏览器同源策略以及跨域/" rel="bookmark">
        <time class="entry-date published" datetime="2020-05-26T07:42:02.000Z">
          2020-05-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="什么是浏览器同源策略"><a class="markdownIt-Anchor" href="#什么是浏览器同源策略"></a> 什么是浏览器同源策略</h2>
<p>同源策略（Same origin policy）是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。可以说 Web 是构建在同源策略基础之上的，浏览器只是针对同源策略的一种实现。</p>
<p>它的核心就在于它认为自任何站点装载的信赖内容是不安全的。当被浏览器半信半疑的脚本运行在沙箱时，它们应该只被允许访问来自同一站点的资源，而不是那些来自其它站点可能怀有恶意的资源。</p>
<p>简单的说：<strong>域名、协议、端口相同。</strong></p>
<p>另外，同源策略又分为以下两种：</p>
<p><em><strong>DOM 同源策略</strong></em>：禁止对不同源页面 DOM 进行操作。这里主要场景是 iframe 跨域的情况，不同域名的 iframe 是限制互相访问的。<br />
<em><strong>XMLHttpRequest 同源策略</strong></em>：禁止使用 XHR 对象向不同源的服务器地址发起 HTTP 请求。</p>
<h2 id="跨域的解决方法"><a class="markdownIt-Anchor" href="#跨域的解决方法"></a> 跨域的解决方法</h2>
<p><em><strong>JSONP方法</strong></em></p>
<p>利用 script 标签不受跨域限制，解决跨域数据请求问题。</p>
<p>核心原理就是通过Get请求把数据返回执行本地的JS脚本来完成数据交互。</p>
<p>缺点：</p>
<ul>
<li>只能是 GET 请求。</li>
<li>缺乏有效的异常捕获机制。</li>
</ul>
<p><em><strong>CORS（跨域资源共享）</strong></em></p>
<p>CORS（Cross-origin resource sharing，跨域资源共享）是一个 W3C 标准，定义了在必须访问跨域资源时，浏览器与服务器应该如何沟通。CORS 背后的基本思想，就是使用自定义的 HTTP 头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功，还是应该失败。</p>
<p>CORS 需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，<strong>IE 浏览器不能低于 IE10</strong>。</p>
<p>因此，实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信。</p>
<p>浏览器将CORS请求分成两类：简单请求（simple request）和非简单请求（not-so-simple request）。</p>
<p>只要同时满足以下两大条件，就属于简单请求。</p>
<p>请求方法是以下三种方法之一：</p>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<p>HTTP的头信息不超出以下几种字段：</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：application/x-www-form-urlencoded、multipart/form-data、text/plain</li>
</ul>
<p><strong>凡是不同时满足上面两个条件，就属于非简单请求。</strong></p>
<p><strong>简单请求</strong></p>
<p>在请求中需要附加一个额外的 Origin 头部，其中包含请求页面的源信息（协议、域名和端口），以便服务器根据这个头部信息来决定是否给予响应。例如：Origin: <a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a></p>
<p>如果服务器认为这个请求可以接受，就在 Access-Control-Allow-Origin 头部中回发相同的源信息（如果是公共资源，可以回发 * ）。例如：Access-Control-Allow-Origin：<a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a></p>
<p>没有这个头部或者有这个头部但源信息不匹配，浏览器就会驳回请求。正常情况下，浏览器会处理请求。注意，请求和响应都不包含 cookie 信息。</p>
<p>如果需要包含 cookie 信息，ajax 请求需要设置 xhr 的属性 withCredentials 为 true，服务器需要设置响应头部 Access-Control-Allow-Credentials: true。</p>
<p><strong>非简单请求</strong></p>
<p>浏览器在发送真正的请求之前，会先发送一个 Preflight 请求给服务器，这种请求使用 OPTIONS 方法，发送下列头部：</p>
<p>Origin：跨域地址。<br />
Access-Control-Request-Method: 请求自身使用的方法。<br />
Access-Control-Request-Headers: （可选）自定义的头部信息，多个头部以逗号分隔。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Origin: http:&#x2F;&#x2F;www.baidu.com</span><br><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Access-Control-Request-Headers: ABC</span><br><span class="line">发送这个请求后，服务器可以决定是否允许这种类型的请求。服务器通过在响应中发送如下头部与浏览器进行沟通：</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;www.baidu.com</span><br><span class="line">Access-Control-Allow-Methods: GET, POST 允许的方法，多个方法以逗号分隔。</span><br><span class="line">Access-Control-Allow-Headers: ABC 允许的头部，多个方法以逗号分隔。</span><br><span class="line">Access-Control-Max-Age: 1728000 应该将这个 Preflight 请求缓存多长时间（以秒表示）。</span><br></pre></td></tr></table></figure>
<p>优点</p>
<ul>
<li>CORS 通信与同源的 AJAX 通信没有差别，代码完全一样，容易维护。</li>
<li>支持所有类型的 HTTP 请求。</li>
</ul>
<p>缺点</p>
<ul>
<li>存在兼容性问题，特别是 IE10 以下的浏览器。</li>
<li>第一次发送非简单请求时会多一次请求。</li>
</ul>
<p><em><strong>图像 Ping 跨域</strong></em></p>
<p>由于 img 标签不受浏览器同源策略的影响，允许跨域引用资源。因此可以通过 img 标签的 src 属性进行跨域，这也就是图像 Ping 跨域的基本原理。</p>
<p>直接通过下面的例子来说明图像 Ping 实现跨域的流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var img &#x3D; new Image();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 通过 onload 及 onerror 事件可以知道响应是什么时候接收到的，但是不能获取响应文本</span><br><span class="line">img.onload &#x3D; img.onerror &#x3D; function() &#123;</span><br><span class="line">    console.log(&quot;Done!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 本质上和JSONP原理是相同</span><br><span class="line">img.src &#x3D; &#39;http:&#x2F;&#x2F;www.laixiangran.cn&#x2F;test?name&#x3D;laixiangran&#39;;</span><br></pre></td></tr></table></figure>
<p>优点<br />
<strong>用于实现跟踪用户点击页面或动态广告曝光次数有较大的优势。</strong></p>
<p>缺点</p>
<ul>
<li>只支持 GET 请求。</li>
<li>只能浏览器与服务器的单向通信，因为浏览器不能访问服务器的响应文本。</li>
</ul>
<p><em><strong>document.domain 跨域</strong></em><br />
对于主域名相同，而子域名不同的情况，可以使用 document.domain 来跨域。</p>
<p><em><strong><a href="http://window.name" target="_blank" rel="noopener">window.name</a> 跨域</strong></em><br />
window 对象有个 name 属性，该属性有个特征：即在一个窗口（window）的生命周期内，窗口载入的所有的页面（不管是相同域的页面还是不同域的页面）都是共享一个 <a href="http://window.name" target="_blank" rel="noopener">window.name</a> 的，每个页面对 <a href="http://window.name" target="_blank" rel="noopener">window.name</a> 都有读写的权限，<a href="http://window.name" target="_blank" rel="noopener">window.name</a> 是持久存在一个窗口载入过的所有页面中的，并不会因新页面的载入而进行重置。</p>
<p><em><strong>location.hash 跨域</strong></em><br />
location.hash 方式跨域，是子框架具有修改父框架 src 的 hash 值，通过这个属性进行传递数据，且更改 hash 值，页面不会刷新。但是传递的数据的字节数是有限的。</p>
<p><em><strong>postMessage 跨域</strong></em><br />
window.postMessage(message，targetOrigin) 方法是 HTML5 新引进的特性，可以使用它来向其它的 window 对象发送消息，无论这个 window 对象是属于同源或不同源。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/05/26/基数统计算法/"><span>基数统计算法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/05/26/基数统计算法/" rel="bookmark">
        <time class="entry-date published" datetime="2020-05-26T06:23:04.000Z">
          2020-05-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>redis pfadd</p>
<p>es</p>
<p>Hyperloglog 不精确去重算法，基于概率学的实现。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/常识/">常识</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/算法/">算法</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/05/25/Go信号处理/"><span>Go信号处理</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/05/25/Go信号处理/" rel="bookmark">
        <time class="entry-date published" datetime="2020-05-25T10:10:21.000Z">
          2020-05-25
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h3 id="常见信号"><a class="markdownIt-Anchor" href="#常见信号"></a> 常见信号</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th style="text-align:left">Linux</th>
<th style="text-align:left">Desc</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:left">SIGHUP</td>
<td style="text-align:left">“hangup”-重启</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left">SIGINT</td>
<td style="text-align:left">“interrupt”-中断-<code>Ctrl + C</code></td>
</tr>
<tr>
<td>3</td>
<td style="text-align:left">SIGQUIT</td>
<td style="text-align:left">“quit”-退出-<code>Ctrl + /</code></td>
</tr>
<tr>
<td>4</td>
<td style="text-align:left">SIGILL</td>
<td style="text-align:left">“illegal instruction”-非法指令，错误修改代码段</td>
</tr>
<tr>
<td>5</td>
<td style="text-align:left">SIGTRAP</td>
<td style="text-align:left">“trace/BPT trap”-陷阱-<code>断点指令或其它trap指令产生,调试用途</code></td>
</tr>
<tr>
<td>6</td>
<td style="text-align:left">SIGABRT</td>
<td style="text-align:left">“abort trap”-<code>调用 abort 函数生成的信号</code></td>
</tr>
<tr>
<td>7</td>
<td style="text-align:left">SIGEMT</td>
<td style="text-align:left">“EMT trap”-内存越界</td>
</tr>
<tr>
<td>8</td>
<td style="text-align:left">SIGFPE</td>
<td style="text-align:left">“floating point exception”-浮点数异常</td>
</tr>
<tr>
<td>9</td>
<td style="text-align:left">SIGKILL</td>
<td style="text-align:left">“killed”-杀死进程信号</td>
</tr>
<tr>
<td>10</td>
<td style="text-align:left">SIGBUS</td>
<td style="text-align:left">“bus error”-总线错误</td>
</tr>
<tr>
<td>11</td>
<td style="text-align:left">SIGSEGV</td>
<td style="text-align:left">“segmentation fault”-段错误</td>
</tr>
<tr>
<td>12</td>
<td style="text-align:left">SIGSYS</td>
<td style="text-align:left">“bad system call”-错误系统调用</td>
</tr>
<tr>
<td>13</td>
<td style="text-align:left">SIGPIPE</td>
<td style="text-align:left">“broken pipe”-管道异常</td>
</tr>
<tr>
<td>14</td>
<td style="text-align:left">SIGALRM</td>
<td style="text-align:left">“alarm clock”-时钟</td>
</tr>
<tr>
<td>15</td>
<td style="text-align:left">SIGTERM</td>
<td style="text-align:left">“terminated”-中断</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>SIGHUP （HUP Hangup）<br />
重启</p>
</li>
<li>
<p>SIGINT （INT Interrupt）<br />
程序终止( interrupt )信号, 在用户键入 INTR 字符(通常是 Ctrl + C )时发出，用于通知前台进程组终止进程。</p>
</li>
<li>
<p>SIGQUIT （QUIT Quit）<br />
由 QUIT 字符(通常是 Ctrl + / )来控制. 进程在因收到 SIGQUIT 退出时会产生 core 文件, 在这个意义上类似于一个程序错误信号。</p>
</li>
<li>
<p>SIGILL （ILL Illegal instruction）<br />
执行了非法指令.</p>
</li>
<li>
<p>SIGTRAP （TRAP Trap）<br />
由断点指令或其它 trap 指令产生. 由debugger 使用。</p>
</li>
<li>
<p>SIGABRT （ABRT Aborted）<br />
调用 abort 函数生成的信号。</p>
</li>
<li>
<p>SIGBUS （BUS Bus error）<br />
非法地址, 包括内存地址对齐( alignment )出错。比如访问一个四个字长的整数, 但其地址不是 4 的倍数。它与 SIGSEGV 的区别在于后者是由于对合法存储地址的非法访问触发的(如访问不属于自己存储空间或只读存储空间)。</p>
</li>
<li>
<p>SIGFPE （FPE Floating point exception）<br />
在发生致命的算术运算错误时发出. 不仅包括浮点运算错误, 还包括溢出及除数为0等其它所有的算术的错误。</p>
</li>
<li>
<p>SIGKILL （KILL Killed）<br />
用来立即结束程序的运行。本信号不能被阻塞、处理和忽略。</p>
</li>
<li>
<p>SIGUSR1 （USR1 User signal 1）<br />
留给用户使用</p>
</li>
<li>
<p>SIGSEGV （SEGV Segmentation fault）<br />
试图访问未分配给自己的内存, 或试图往没有写权限的内存地址写数据。</p>
</li>
<li>
<p>SIGUSR2 （USR2 User signal 2）<br />
留给用户使用</p>
</li>
<li>
<p>SIGPIPE （PIPE Broken pipe）<br />
管道破裂。这个信号通常在进程间通信产生，比如采用 FIFO (管道)通信的两个进程，读管道没打开或者意外终止就往管道写，写进程会收到 SIGPIPE 信号。此外用Socket 通信的两个进程，写进程在写 Socket 的时候，读进程已经终止。</p>
</li>
<li>
<p>SIGALRM （ALRM Alarm clock）<br />
时钟定时信号。alarm 函数使用该信号。</p>
</li>
<li>
<p>SIGTERM （TERM Terminated）<br />
程序结束( terminate )信号, 与 SIGKILL 不同的是该信号可以被阻塞和处理。通常用来要求程序自己正常退出，shell 命令 kill 缺省产生这个信号。如果进程终止不了，我们才会尝试 SIGKILL。</p>
</li>
<li>
<p>SIGCHLD （CHLD Child exited）<br />
子进程结束时, 父进程会收到这个信号。</p>
</li>
</ol>
<p>如果父进程没有处理这个信号，也没有等待( wait )子进程，子进程虽然终止，但是还会在内核进程表中占有表项，这时的子进程称为僵尸进程。这种情况我们应该避免(父进程或者忽略 SIGCHILD 信号，或者捕捉它，或者 wait 它派生的子进程，或者父进程先终止，这时子进程的终止自动由 init 进程来接管)。</p>
<ol start="18">
<li>
<p>SIGCONT （CONT Continue）<br />
让一个停止( stopped )的进程继续执行。本信号不能被阻塞。</p>
</li>
<li>
<p>SIGSTOP （STOP Stopped (signal)）<br />
停止( stopped )进程的执行。注意它和 terminate 以及 interrupt 的区别：该进程还未结束, 只是暂停执行。本信号不能被阻塞，处理或忽略。</p>
</li>
<li>
<p>SIGTSTP （TSTP Stopped）<br />
停止进程的运行, 但该信号可以被处理和忽略。用户键入 SUSP 字符时(通常是 Ctrl + Z )发出这个信号。</p>
</li>
<li>
<p>SIGTTIN （TTIN Stopped (tty input)）<br />
当后台作业要从用户终端读数据时，该作业中的所有进程会收到 SIGTTIN 信号。缺省时这些进程会停止执行。</p>
</li>
<li>
<p>SIGTTOU （TTOU Stopped (tty output)）<br />
类似于 SIGTTIN，但在写终端(或修改终端模式)时收到。</p>
</li>
<li>
<p>SIGURG （URG Urgent I/O condition）<br />
有“紧急”数据或 out-of-band 数据到达 socket 时产生。</p>
</li>
<li>
<p>SIGXCPU （XCPU CPU time limit exceeded）<br />
超过 CPU 时间资源限制。这个限制可以由 getrlimit/setrlimit 来读取/改变。</p>
</li>
<li>
<p>SIGXFSZ （XFSZ File size limit exceeded）<br />
当进程企图扩大文件以至于超过文件大小资源限制。</p>
</li>
<li>
<p>SIGVTALRM （VTALRM Virtual timer expired）<br />
虚拟时钟信号。类似于 SIGALRM，但是计算的是该进程占用的 CPU 时间。</p>
</li>
<li>
<p>SIGPROF （PROF Profiling timer expired）<br />
类似于 SIGALRM/SIGVTALRM，但包括该进程用的 CPU 时间以及系统调用的时间。</p>
</li>
<li>
<p>SIGWINCH （WINCH Window size changed）<br />
窗口大小改变时发出。</p>
</li>
<li>
<p>SIGIO （IO I/O possible）<br />
文件描述符准备就绪，可以开始进行输入/输出操作。</p>
</li>
<li>
<p>SIGPWR （PWR Power failure）<br />
Power failure</p>
</li>
<li>
<p>SIGSYS （SYS Bad system call）<br />
非法的系统调用。</p>
</li>
</ol>
<ul>
<li>程序不可捕获、阻塞或忽略的信号有：SIGKILL,SIGSTOP</li>
<li>不能恢复至默认动作的信号有：SIGILL,SIGTRAP</li>
<li>默认会导致进程流产的信号有：SIGABRT,SIGBUS,SIGFPE,SIGILL,SIGIOT,SIGQUIT,SIGSEGV,SIGTRAP,SIGXCPU,SIGXFSZ</li>
<li>默认会导致进程退出的信号有：SIGALRM,SIGHUP,SIGINT,SIGKILL,SIGPIPE,SIGPOLL,SIGPROF,SIGSYS,SIGTERM,SIGUSR1,SIGUSR2,SIGVTALRM</li>
<li>默认会导致进程停止的信号有：SIGSTOP,SIGTSTP,SIGTTIN,SIGTTOU</li>
<li>默认进程忽略的信号有：SIGCHLD,SIGPWR,SIGURG,SIGWINCH</li>
<li>此外，SIGIO 在 SVR4 是退出，在 4.3BSD 中是忽略；SIGCONT 在进程挂起时是继续，否则是忽略，不能被阻塞。</li>
</ul>
<h3 id="go信号处理"><a class="markdownIt-Anchor" href="#go信号处理"></a> Go信号处理</h3>
<ul>
<li>通常应用程序需要处理以下信号：
<ul>
<li>SIGHUP
<ul>
<li>重启信号，一般用于进程正常的重新加载配置文件后正常启动。</li>
</ul>
</li>
<li>SIGINT
<ul>
<li>拦截前台程序意外的使用<code>Ctrl + C</code>导致程序中断。</li>
</ul>
</li>
<li>SIGQUIT
<ul>
<li>拦截前台程序意外的使用<code>Ctrl + /</code>导致程序中断。</li>
</ul>
</li>
<li>SIGTSTP
<ul>
<li>拦截前台程序意外的使用<code>Ctrl + Z</code>导致程序暂停。</li>
</ul>
</li>
<li>SIGTERM
<ul>
<li>处理程序的正常退出流程。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"os/signal"</span></span><br><span class="line">	<span class="string">"syscall"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetStartTime</span><span class="params">()</span></span> &#123;</span><br><span class="line">	pid := os.Getpid()</span><br><span class="line">	ppid := os.Getppid()</span><br><span class="line">	fmt.Printf(<span class="string">"进程 PID: %d PPID: %d \n"</span>, pid, ppid)</span><br><span class="line"></span><br><span class="line">	ppProcess, err := os.FindProcess(ppid)</span><br><span class="line">	<span class="keyword">if</span> <span class="literal">nil</span> != err &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"进程 PPID: %d \n"</span>, ppProcess.Pid)</span><br><span class="line"></span><br><span class="line">	goProcess, err := os.StartProcess(<span class="string">"go"</span>, []<span class="keyword">string</span>&#123;<span class="string">"version"</span>&#125;, &amp;os.ProcAttr&#123;</span><br><span class="line">		Dir: <span class="string">"/usr/local/go/bin/"</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> <span class="literal">nil</span> != err &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"PID: %d\n"</span>, goProcess.Pid)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//err = ppProcess.Kill()</span></span><br><span class="line">	<span class="comment">//if nil != err &#123;</span></span><br><span class="line">	<span class="comment">//	fmt.Println(err)</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> App <span class="keyword">interface</span> &#123;</span><br><span class="line">	Start()</span><br><span class="line">	Stop()</span><br><span class="line">	ReStart()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CommonApp <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(app *CommonApp)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Start"</span>)</span><br><span class="line">	GetStartTime()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(app *CommonApp)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Stop"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(app *CommonApp)</span> <span class="title">ReStart</span><span class="params">()</span></span> &#123;</span><br><span class="line">	app.Stop()</span><br><span class="line">	app.Start()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	comonApp := CommonApp&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> app App = &amp;comonApp</span><br><span class="line">	Enter(app)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Enter</span><span class="params">(app App)</span></span> &#123;</span><br><span class="line">	app.Start()</span><br><span class="line">	exit := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">	reload := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">	<span class="keyword">go</span> ProcSignal(exit, reload)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-reload:</span><br><span class="line">			app.ReStart()</span><br><span class="line">		<span class="keyword">case</span> &lt;-exit:</span><br><span class="line">			app.Stop()</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ProcSignal</span><span class="params">(exit <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, reload <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	signals := <span class="built_in">make</span>(<span class="keyword">chan</span> os.Signal)</span><br><span class="line">	signal.Notify(signals, syscall.SIGTSTP, syscall.SIGQUIT, syscall.SIGINT, syscall.SIGUSR1, syscall.SIGUSR2, syscall.SIGHUP, syscall.SIGTERM)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		sig := &lt;-signals</span><br><span class="line">		fmt.Println(<span class="string">"接收信号:"</span>, sig)</span><br><span class="line">		<span class="keyword">if</span> sig == syscall.SIGTERM &#123;</span><br><span class="line">			fmt.Println(<span class="string">"终止程序"</span>)</span><br><span class="line">			signal.Stop(signals)</span><br><span class="line">			exit &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> sig &#123;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Printf(<span class="string">"接收信号=%v\n"</span>, sig)</span><br><span class="line">		<span class="keyword">case</span> syscall.SIGINT:</span><br><span class="line">			fmt.Println(<span class="string">"中断信号"</span>)</span><br><span class="line">		<span class="keyword">case</span> syscall.SIGTSTP:</span><br><span class="line">			fmt.Println(<span class="string">"暂停信号"</span>)</span><br><span class="line">		<span class="keyword">case</span> syscall.SIGQUIT:</span><br><span class="line">			fmt.Println(<span class="string">"退出信号"</span>)</span><br><span class="line">		<span class="keyword">case</span> syscall.SIGHUP:</span><br><span class="line">			fmt.Println(<span class="string">"重启信号"</span>)</span><br><span class="line">			reload &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">		<span class="keyword">case</span> syscall.SIGUSR1:</span><br><span class="line">			fmt.Println(<span class="string">"用户信号-1"</span>)</span><br><span class="line">		<span class="keyword">case</span> syscall.SIGUSR2:</span><br><span class="line">			fmt.Println(<span class="string">"用户信号-2"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/05/21/OpenResty相关/"><span>OpenResty相关</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/05/21/OpenResty相关/" rel="bookmark">
        <time class="entry-date published" datetime="2020-05-21T08:28:14.000Z">
          2020-05-21
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <img src="/2020/05/21/OpenResty%E7%9B%B8%E5%85%B3/1.png" class="">
<h3 id="nginx阶段"><a class="markdownIt-Anchor" href="#nginx阶段"></a> Nginx阶段</h3>
<p>NGX_HTTP_POST_READ_PHASE: 接收完请求头之后的第一个阶段，它位于URI重写之前。</p>
<p>NGX_HTTP_SERVER_REWRITE_PHASE: 处理全局的(server block)的rewrite规则。Nginx会根据Host及端口找到对应的虚拟主机配置。</p>
<p>NGX_HTTP_FIND_CONFIG_PHASE: 寻找Location配置阶段，该阶段可能会被执行多次，因为也可能有Location级别的重写指令。</p>
<p>NGX_HTTP_REWRITE_PHASE: Location级别的uri重写阶段，该阶段执行Location基本的重写指令，也可能会被执行多次。</p>
<p>NGX_HTTP_POST_REWRITE_PHASE: Location级别重写的后一阶段，用来检查上阶段是否有Uri重写，并根据结果跳转到合适的阶段。</p>
<p>NGX_HTTP_PREACCESS_PHASE: 访问权限控制的前一阶段，该阶段在权限控制阶段之前，一般也用于访问控制，比如限制访问频率，链接数等。</p>
<p>NGX_HTTP_ACCESS_PHASE: 访问权限控制阶段，比如基于ip黑白名单的权限控制，基于用户名密码的权限控制等。</p>
<p>NGX_HTTP_POST_ACCESS_PHASE: 问权限控制的后一阶段，该阶段根据权限控制阶段的执行结果进行相应处理。</p>
<p>NGX_HTTP_TRY_FILES_PHASE: try_files指令的处理阶段，如果没有配置try_files指令，则该阶段被跳过</p>
<p>NGX_HTTP_CONTENT_PHASE: 内容生成阶段，该阶段产生响应，并发送到客户端</p>
<p>NGX_HTTP_LOG_PHASE: 日志记录阶段，该阶段记录访问日志</p>
<h3 id="openresty阶段"><a class="markdownIt-Anchor" href="#openresty阶段"></a> OpenResty阶段</h3>
<ul>
<li>
<p>init_by_Lua：初始化Nginx和预加载Lua(Nginx启动和Reload时执行)</p>
<ul>
<li>Master进程执行
<ul>
<li>启动阶段需要执行的代码。</li>
<li>初始化Nginx的共享内存。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>init_worker_by_lua*：每个工作进程(worker_processes)被创建时执行</p>
</li>
</ul>
<ul>
<li>工作进程执行
<ul>
<li>定时任务</li>
<li>健康检查</li>
<li>定时获取配置信息。</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>ssl_certificate_by_lua*：对https请求的处理</p>
</li>
<li>
<p>set_by_lua*：设置 nginx 变量；</p>
</li>
<li>
<p>rewrite_by_lua*：重写请求;</p>
</li>
<li>
<p>access_by_lua*：访问控制（黑白名单）；</p>
</li>
<li>
<p>content_by_lua*：执行业务逻辑并产生响应；</p>
</li>
<li>
<p>balancer_by_lua*：负载均衡upstream中使用；</p>
</li>
<li>
<p>header_filter_by_lua*：过滤响应头；</p>
</li>
<li>
<p>body_filter_by_lua*：过滤响应体；</p>
</li>
<li>
<p>log_by_lua*：记录访问日志；</p>
</li>
</ul>
<p><a href="https://github.com/openresty/lua-nginx-module" target="_blank" rel="noopener">文档地址</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/OpenResty/">OpenResty</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Nginx/">Nginx</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/2/" class="pagination-prev">上一页</a>
  
  
  <a href="/page/4/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 ideath@operatorworld.com
    
  </p>
</footer>
    
  </div>
</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>